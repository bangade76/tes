<!DOCTYPE html>
<html>

<head>
  <title>MSR 60K Category</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <link rel="dns-prefetch" href="https://tile.openstreetmap.org" />
  <link rel="dns-prefetch preconnect" href="https://unpkg.com" />
  <link rel="preload" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" as="script">
  <link rel="preload" href="https://unpkg.com/leaflet-ui@0.6.0/dist/leaflet-ui.js" as="script">

  <style>@import 'css/fullpage.css';</style>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-ui@0.6.0/dist/leaflet-ui.js"></script>

  <!-- GPX plugin -->
  <script src="https://unpkg.com/leaflet-gpx@1.7.0/gpx.js"></script>

  <!-- Elevation plugin -->
  <link rel="stylesheet" href="https://unpkg.com/@raruto/leaflet-elevation@2.5.1/dist/leaflet-elevation.min.css" />
  <script src="https://unpkg.com/@raruto/leaflet-elevation@2.5.1/dist/leaflet-elevation.min.js"></script>
</head>

<body>

  <div id="map" class="leaflet-map" style="height: 100vh;"></div>

  <script>
  // Pas bagian atas sebelum map dibuat
  const customPin = L.icon({
    iconUrl: 'images/ws_pin.png',
    iconSize: [32, 32],
    iconAnchor: [16, 32],
    popupAnchor: [0, -32],
  });

  let opts = {
    map: { /* konfigurasi peta seperti sebelumnya */ },

    elevationControl: {
      url: "uitr/60KM_NEW.gpx",
      options: {
        theme: "lightblue-theme",
        width: 100,
        height: 150,
        collapsed: false,
        autohide: false,
        autofitBounds: true,
        position: "bottomleft",
        detached: true,
        summary: false,
        imperial: false,
        downloadLink: false,
        slope: "disabled",
        speed: false,
        acceleration: false,
        time: false,
        legend: true,
        followMarker: true,
        almostOver: true,
        distanceMarkers: false,
        hotline: false,

        // <<< markerOptions dengan custom icon harus di sini
        markerOptions: {
          icon: customPin
        }
      },
    },

    layersControl: { options: { collapsed: false } },
  };

  // Inisialisasi peta
  let map = L.map('map', opts.map);

  // Buat control elevation dengan opsi yang sudah disertakan markerOptions
  let controlElevation = L.control.elevation(opts.elevationControl.options).addTo(map);
  let controlLayer = L.control.layers(null, null, opts.layersControl.options);

  controlElevation.on('eledata_loaded', ({ layer }) => {
  layer.eachLayer(pt => {
    console.log(pt); // lihat apakah marker memiliki opsi icon
  });
});


  controlElevation.load(opts.elevationControl.url);
</script>
  <script>
    // === Localisasi Label Elevation ===
    L.registerLocale('en:18', {
      "Acceleration": "Acceleration",
      "Altitude": "Elevation",
      "Slope": "Slope",
      "Speed": "Velocity",
      "Total Length: ": "L: ",
      "Max Elevation: ": "E Max: ",
      "Min Elevation: ": "E Min: ",
      "Avg Elevation: ": "E Avg: ",
      "Total Time: ": "T: ",
      "Total Ascent: ": "Asc: ",
      "Total Descent: ": "Desc: ",
      "Min Slope: ": "S Min: ",
      "Max Slope: ": "S Max: ",
      "Avg Slope: ": "S Avg: ",
      "Min Speed: ": "V Min: ",
      "Max Speed: ": "V Max: ",
      "Avg Speed: ": "V Avg: ",
      "Min Acceleration: ": "A Min: ",
      "Max Acceleration: ": "A Max: ",
      "Avg Acceleration: ": "A Avg: ",
    });

    L.locales['en'] = L.extend({
      "y: ": "",
      "x: ": "",
      "t: ": "",
      "T: ": "",
      "m: ": "",
      "v: ": "",
      "a: ": "",
    }, L.locales['en']);

    L.setLocale('en');
  </script>

</body>
</html>
